<StructureMap 
  xmlns="http://hl7.org/fhir">
  <id value="FhirToCdaTypes"/>
  <meta>
    <versionId value="4"/>
    <lastUpdated value="2022-05-24T12:19:27.952+00:00"/>
  </meta>
  <text>
    <status value="generated"/>
    <div 
      xmlns="http://www.w3.org/1999/xhtml">
      <pre>map &quot;http://fhir.ch/ig/cda-fhir-maps/StructureMap/FhirToCdaTypes&quot; = &quot;FhirToCdaTypes&quot;

// Adapted from https://github.com/HL7/ccda-to-fhir/tree/master/mappings
// CDA:  http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/master/index.html
// FHIR: http://hl7.org/fhir/r4/

conceptmap &quot;uri2oid&quot; {
  prefix s = &quot;http://hl7.org/fhir&quot;
  prefix t = &quot;http://hl7.org/cda&quot;

  s:&quot;http://snomed.info/sct&quot; == t:&quot;2.16.840.1.113883.6.96&quot;
  s:&quot;http://loinc.org&quot; == t:&quot;2.16.840.1.113883.6.1&quot;
  s:&quot;http://hl7.org/fhir/sid/atc&quot; == t:&quot;2.16.840.1.113883.6.73&quot;
  s:&quot;http://www.whocc.no/atc&quot; == t:&quot;2.16.840.1.113883.6.73&quot;
  s:&quot;http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution&quot; == t:&quot;2.16.840.1.113883.5.1070&quot;
}

conceptmap &quot;uri2system&quot; {
  prefix s = &quot;http://hl7.org/fhir&quot;
  prefix t = &quot;http://hl7.org/cda&quot;

  s:&quot;http://snomed.info/sct&quot; == t:&quot;SNOMED CT&quot;
  s:&quot;http://loinc.org&quot; == t:LOINC
  s:&quot;http://hl7.org/fhir/sid/atc&quot; == t:&quot;ATC WHO&quot;
  s:&quot;http://www.whocc.no/atc&quot; == t:&quot;ATC WHO&quot;
  s:&quot;http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution&quot; == t:&quot;HL7 Substance Admin Substitution&quot;
}

conceptmap &quot;oid2system&quot; {
  prefix s = &quot;http://hl7.org/fhir&quot;
  prefix t = &quot;http://hl7.org/cda&quot;

  s:&quot;urn:oid:2.51.1.1&quot; == t:GTIN
  s:&quot;urn:oid:1.3.6.1.4.1.19376.1.9.2.1&quot; == t:&quot;IHE Pharmaceutical Advice Status List&quot;
}

conceptmap &quot;addressUse&quot; {
  prefix s = &quot;http://hl7.org/fhir/valueset-address-use.html&quot;
  prefix t = &quot;http://terminology.hl7.org/ValueSet/v3-AddressUse&quot;

  s:home == t:H
  s:work == t:WP
  s:temp == t:TMP
  s:old == t:OLD
}

uses &quot;http://hl7.org/fhir/StructureDefinition/Identifier&quot; as source
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/II&quot; as target

group Any(source src, target tgt) {
  src.extension as extension where $this.url = &apos;http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor&apos; -&gt; tgt.nullFlavor as nullFlavor then {
    extension.valueCode as valueCode then {
      valueCode.value as v -&gt; nullFlavor.value = cast(v, &apos;string&apos;);
    } &quot;nullFlavor&quot;;
  };
}

group IdentifierII(source src : Identifier, target tgt : II) extends Any &lt;&lt;types&gt;&gt; {
  src.value as value where src.system.empty() and src.value.startsWith(&apos;urn:uuid:&apos;) -&gt; tgt.root = (value.substring(9).upper()) &quot;idAsUuid&quot;;
  src.value as value where src.system = &apos;urn:ietf:rfc:3986&apos; -&gt; tgt.root = (value.substring(9).upper()) &quot;idAsUuid&quot;;
  src.value as value where src.system.startsWith(&apos;urn:oid:&apos;) then {
    src.system as system -&gt;  tgt.root = (system.substring(8)),  tgt.extension = value &quot;oidident&quot;;
  } &quot;system&quot;;
}

group IntegerINT(source src : integer, target tgt : INT) extends Any &lt;&lt;types&gt;&gt; {
  src.value as v -&gt; tgt.value = v &quot;integer&quot;;
}

// group Identifier(source src : Identifier, target tgt : II) extends Any &lt;&lt;types&gt;&gt; {
// src.system as system then {
// src.value as value then {
// value.value as v where system.value = &apos;urn:ietf:rfc:3986&apos; -&gt; tgt.root = cast(v, &apos;string&apos;) &quot;noExtension&quot;;
// system.value as v where system.value != &apos;urn:ietf:rfc:3986&apos; -&gt; tgt.root = v then {
// value.value as val -&gt; tgt.extension = cast(val, &apos;string&apos;) &quot;extension&quot;;
// } &quot;withExtension&quot;;
// } &quot;rootValue&quot;;
// } &quot;root&quot;;
// src.value as value -&gt; tgt.root = &apos;123&apos; &quot;test&quot;;
// src -&gt; tgt.root = &apos;123&apos; &quot;test&quot;;
// src.assigner as a then {
// a.display as display then {
// display.value as val -&gt; tgt.assigningAuthorityName = cast(val, &apos;string&apos;);
// } &quot;display&quot;;
// } &quot;assigner&quot;;
// src.extension as ext where ext.url = &apos;http://hl7.org/fhir/cdaStructureDefinition/extension-displayable&apos; -&gt; tgt.displayable as displayable then {
// ext.value as v -&gt; displayable.value = cast(v, &apos;string&apos;);
// } &quot;displayable&quot;;
// }
group InstantTS(source src : instant, target tgt : TS) extends Any &lt;&lt;types&gt;&gt; {
  src.value as v -&gt; tgt.value = v &quot;copy&quot;;
}

group DateTimeTS(source src : dateTime, target tgt : TS) extends InstantTS &lt;&lt;types&gt;&gt; {
}

group DateTS(source src : date, target tgt : TS) extends InstantTS &lt;&lt;types&gt;&gt; {
}

group CodeCS(source src : code, target tgt : CS) extends Any &lt;&lt;types&gt;&gt; {
  src.code as c -&gt; tgt.value = cast(c, &apos;string&apos;);
}

group CodeCE(source src : code, target tgt : CE) extends CodeCS &lt;&lt;types&gt;&gt; {
}

group CodeCD(source src : code, target tgt : CD) extends CodeCS &lt;&lt;types&gt;&gt; {
}

group CodingCE(source src : Coding, target tgt : CE) extends Any &lt;&lt;types&gt;&gt; {
  src.code as code -&gt; tgt.code = code;
  src.system as system where $this.startsWith(&apos;http:&apos;) -&gt; tgt.codeSystem = translate(system, &apos;#uri2oid&apos;, &apos;code&apos;);
  src.system as system where $this.startsWith(&apos;urn:oid:&apos;) then {
    src.system as system -&gt; tgt.codeSystem = (system.substring(8)) &quot;oidident&quot;;
  };
  src.system as system where $this.startsWith(&apos;http:&apos;) -&gt; tgt.codeSystemName = translate(system, &apos;#uri2system&apos;, &apos;code&apos;) &quot;systemName1&quot;;
  src.system as system where $this.startsWith(&apos;urn:oid:&apos;) -&gt; tgt.codeSystemName = translate(system, &apos;#oid2system&apos;, &apos;code&apos;) &quot;systemName2&quot;;
  src.display as display -&gt; tgt.displayName = display;
}

group CodeableConceptCE(source src : CodeableConcept, target tgt : CE) extends Any &lt;&lt;types&gt;&gt; {
  src.text as text -&gt;  tgt.orginialText as originalText,  originalText.data = text;
  src.coding first as coding then CodingCE(coding, tgt) &quot;first&quot;;
  src.coding not_first as coding -&gt; tgt.translation as translation then CodingCE(coding, translation) &quot;translation&quot;;
}

// group CECodeableConcept(source src : CE, target tgt : CodeableConcept) extends Any &lt;&lt;types&gt;&gt; {
// src.originalText -&gt; tgt.text;
// src -&gt; tgt.coding as coding then {
// src.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
// src.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
// src.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
// } &quot;code&quot;;
// src.translation as translation -&gt; tgt.coding as coding then {
// translation.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
// translation.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
// translation.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
// } &quot;translation&quot;;
// }
group AddressAD(source src : Address, target tgt : AD) extends Any &lt;&lt;types&gt;&gt; {
  src.line as v -&gt;  tgt.streetAddressLine as line,  line.data = v &quot;streetAddress&quot;;
  src.postalCode as v -&gt;  tgt.postalCode as postalCode,  postalCode.data = v;
  src where $this.postalCode.exists() = false -&gt;  tgt.postalCode as postalCode,  postalCode.nullFlavor = &apos;NI&apos; &quot;nullFlavor&quot;;
  src.city as v -&gt;  tgt.city as city,  city.data = v;
  src where $this.city.exists() = false -&gt;  tgt.city as city,  city.nullFlavor = &apos;NI&apos; &quot;nullFlavor&quot;;
  src.state as v -&gt;  tgt.state as state,  state.data = v;
  src.district as v -&gt;  tgt.county as county,  county.data = v;
  src.country as v -&gt;  tgt.country as country,  country.data = v;
  src where $this.country.exists() = false -&gt;  tgt.country as country,  country.nullFlavor = &apos;NI&apos; &quot;nullFlavor&quot;;
  src.use as c -&gt; tgt.use = translate(c, &apos;#addressUse&apos;, &apos;code&apos;) &quot;addressUse&quot;;
}

group ContactPointTEL(source src : ContactPoint, target tgt : TEL) extends Any &lt;&lt;types&gt;&gt; {
  src.value as value -&gt; tgt.value = (iif(%src.system = &apos;phone&apos;, &apos;tel:&apos;, &apos;&apos;) + iif(%src.system = &apos;fax&apos;, &apos;fax:&apos;, &apos;&apos;) + iif(%src.system = &apos;email&apos;, &apos;mailto:&apos;, &apos;&apos;) + iif(%src.system = &apos;url&apos;, &apos;http:&apos;, &apos;&apos;) + value);
  src.use as use where $this = &apos;home&apos; -&gt; tgt.use = &apos;HP&apos;;
  src.use as use where $this = &apos;work&apos; -&gt; tgt.use = &apos;WP&apos;;
  src.use as use where $this = &apos;old&apos; -&gt; tgt.use = &apos;BAD&apos;;
  src.use as use where $this = &apos;temp&apos; -&gt; tgt.use = &apos;TMP&apos;;
  src.use as use where $this = &apos;mobile&apos; -&gt; tgt.use = &apos;MC&apos;;
}

group HumanNameEN(source src : HumanName, target tgt : EN) extends Any &lt;&lt;types&gt;&gt; {
  src.family as v -&gt;  tgt.family as family,  family.data = v;
  src.given as v -&gt;  tgt.given as given,  given.data = v;
  src.prefix as v -&gt;  tgt.prefix as prefix,  prefix.data = v,  prefix.qualifier = &apos;AC&apos; &quot;CDA-CH prefix&quot;;
  src.suffix as v -&gt;  tgt.suffix as suffix,  suffix.data = v;
}

group QuantityPQ(source src : Quantity, target tgt : PQ) extends Any &lt;&lt;types&gt;&gt; {
  src.code as code -&gt; tgt.unit = code;
  src.value as value -&gt; tgt.value = value;
}

group RatioRTOPQPQ(source src : Ratio, target tgt : RTO_PQ_PQ) extends Any &lt;&lt;types&gt;&gt; {
  src.numerator as numerator -&gt; tgt.numerator as targetNumerator then QuantityPQ(numerator, targetNumerator);
  src.denominator as denominator -&gt; tgt.denominator as targetDenominator then QuantityPQ(denominator, targetDenominator);
}

</pre>
    </div>
  </text>
  <contained>
    <ConceptMap 
      xmlns="http://hl7.org/fhir">
      <id value="uri2oid"/>
      <status value="draft"/>
      <group>
        <source value="http://hl7.org/fhir"/>
        <target value="http://hl7.org/cda"/>
        <element>
          <code value="http://snomed.info/sct"/>
          <target>
            <code value="2.16.840.1.113883.6.96"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://loinc.org"/>
          <target>
            <code value="2.16.840.1.113883.6.1"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://hl7.org/fhir/sid/atc"/>
          <target>
            <code value="2.16.840.1.113883.6.73"/>
            <equivalence value="equivalent"/>
            <comment value="see issue #4"/>
          </target>
        </element>
        <element>
          <code value="http://www.whocc.no/atc"/>
          <target>
            <code value="2.16.840.1.113883.6.73"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"/>
          <target>
            <code value="2.16.840.1.113883.5.1070"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap 
      xmlns="http://hl7.org/fhir">
      <id value="uri2system"/>
      <status value="draft"/>
      <group>
        <source value="http://hl7.org/fhir"/>
        <target value="http://hl7.org/cda"/>
        <element>
          <code value="http://snomed.info/sct"/>
          <target>
            <code value="SNOMED CT"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://loinc.org"/>
          <target>
            <code value="LOINC"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://hl7.org/fhir/sid/atc"/>
          <target>
            <code value="ATC WHO"/>
            <equivalence value="equivalent"/>
            <comment value="see issue #4"/>
          </target>
        </element>
        <element>
          <code value="http://www.whocc.no/atc"/>
          <target>
            <code value="ATC WHO"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"/>
          <target>
            <code value="HL7 Substance Admin Substitution"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap 
      xmlns="http://hl7.org/fhir">
      <id value="oid2system"/>
      <status value="draft"/>
      <group>
        <source value="http://hl7.org/fhir"/>
        <target value="http://hl7.org/cda"/>
        <element>
          <code value="urn:oid:2.51.1.1"/>
          <target>
            <code value="GTIN"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="urn:oid:1.3.6.1.4.1.19376.1.9.2.1"/>
          <target>
            <code value="IHE Pharmaceutical Advice Status List"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap 
      xmlns="http://hl7.org/fhir">
      <id value="addressUse"/>
      <status value="draft"/>
      <group>
        <source value="http://hl7.org/fhir/valueset-address-use.html"/>
        <target value="http://terminology.hl7.org/ValueSet/v3-AddressUse"/>
        <element>
          <code value="home"/>
          <target>
            <code value="H"/>
            <equivalence value="equivalent"/>
            <comment value="home -> home address"/>
          </target>
        </element>
        <element>
          <code value="work"/>
          <target>
            <code value="WP"/>
            <equivalence value="equivalent"/>
            <comment value="work -> work place"/>
          </target>
        </element>
        <element>
          <code value="temp"/>
          <target>
            <code value="TMP"/>
            <equivalence value="equivalent"/>
            <comment value="Temporary -> temporary address"/>
          </target>
        </element>
        <element>
          <code value="old"/>
          <target>
            <code value="OLD"/>
            <equivalence value="equivalent"/>
            <comment value="Old / Incorrect -> no longer in use, could be also t:&quot;BAD&quot; for bad address"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <url value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/FhirToCdaTypes"/>
  <name value="FhirToCdaTypes"/>
  <description value="Adapted from https://github.com/HL7/ccda-to-fhir/tree/master/mappings&#xd;&#xa;CDA:  http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/master/index.html&#xd;&#xa;FHIR: http://hl7.org/fhir/r4/"/>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Identifier"/>
    <mode value="source"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/cda/StructureDefinition/II"/>
    <mode value="target"/>
  </structure>
  <group>
    <name value="Any"/>
    <typeMode value="none"/>
    <input>
      <name value="src"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="extension"/>
      <source>
        <context value="src"/>
        <element value="extension"/>
        <variable value="extension"/>
        <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="nullFlavor"/>
        <variable value="nullFlavor"/>
      </target>
      <rule>
        <name value="nullFlavor"/>
        <source>
          <context value="extension"/>
          <element value="valueCode"/>
          <variable value="valueCode"/>
        </source>
        <rule>
          <name value="value"/>
          <source>
            <context value="valueCode"/>
            <element value="value"/>
            <variable value="v"/>
          </source>
          <target>
            <context value="nullFlavor"/>
            <contextType value="variable"/>
            <element value="value"/>
            <transform value="cast"/>
            <parameter>
              <valueId value="v"/>
            </parameter>
            <parameter>
              <valueString value="string"/>
            </parameter>
          </target>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="IdentifierII"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="Identifier"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="II"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="idAsUuid"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="value"/>
        <condition value="src.system.empty() and src.value.startsWith('urn:uuid:')"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="root"/>
        <transform value="evaluate"/>
        <parameter>
          <valueString value="value.substring(9).upper()"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="idAsUuid"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="value"/>
        <condition value="src.system = 'urn:ietf:rfc:3986'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="root"/>
        <transform value="evaluate"/>
        <parameter>
          <valueString value="value.substring(9).upper()"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="system"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="value"/>
        <condition value="src.system.startsWith('urn:oid:')"/>
      </source>
      <rule>
        <name value="oidident"/>
        <source>
          <context value="src"/>
          <element value="system"/>
          <variable value="system"/>
        </source>
        <target>
          <context value="tgt"/>
          <contextType value="variable"/>
          <element value="root"/>
          <transform value="evaluate"/>
          <parameter>
            <valueString value="system.substring(8)"/>
          </parameter>
        </target>
        <target>
          <context value="tgt"/>
          <contextType value="variable"/>
          <element value="extension"/>
          <transform value="copy"/>
          <parameter>
            <valueId value="value"/>
          </parameter>
        </target>
      </rule>
    </rule>
  </group>
  <group>
    <name value="IntegerINT"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="integer"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="INT"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="integer"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="InstantTS"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <documentation value="group Identifier(source src : Identifier, target tgt : II) extends Any &lt;&lt;types>> {&#xd;&#xa;src.system as system then {&#xd;&#xa;src.value as value then {&#xd;&#xa;value.value as v where system.value = 'urn:ietf:rfc:3986' -> tgt.root = cast(v, 'string') &quot;noExtension&quot;;&#xd;&#xa;system.value as v where system.value != 'urn:ietf:rfc:3986' -> tgt.root = v then {&#xd;&#xa;value.value as val -> tgt.extension = cast(val, 'string') &quot;extension&quot;;&#xd;&#xa;} &quot;withExtension&quot;;&#xd;&#xa;} &quot;rootValue&quot;;&#xd;&#xa;} &quot;root&quot;;&#xd;&#xa;src.value as value -> tgt.root = '123' &quot;test&quot;;&#xd;&#xa;src -> tgt.root = '123' &quot;test&quot;;&#xd;&#xa;src.assigner as a then {&#xd;&#xa;a.display as display then {&#xd;&#xa;display.value as val -> tgt.assigningAuthorityName = cast(val, 'string');&#xd;&#xa;} &quot;display&quot;;&#xd;&#xa;} &quot;assigner&quot;;&#xd;&#xa;src.extension as ext where ext.url = 'http://hl7.org/fhir/cdaStructureDefinition/extension-displayable' -> tgt.displayable as displayable then {&#xd;&#xa;ext.value as v -> displayable.value = cast(v, 'string');&#xd;&#xa;} &quot;displayable&quot;;&#xd;&#xa;}"/>
    <input>
      <name value="src"/>
      <type value="instant"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="TS"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="copy"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="DateTimeTS"/>
    <extends value="InstantTS"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="dateTime"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="TS"/>
      <mode value="target"/>
    </input>
  </group>
  <group>
    <name value="DateTS"/>
    <extends value="InstantTS"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="date"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="TS"/>
      <mode value="target"/>
    </input>
  </group>
  <group>
    <name value="CodeCS"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="code"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="CS"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="code"/>
      <source>
        <context value="src"/>
        <element value="code"/>
        <variable value="c"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="cast"/>
        <parameter>
          <valueId value="c"/>
        </parameter>
        <parameter>
          <valueString value="string"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="CodeCE"/>
    <extends value="CodeCS"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="code"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="CE"/>
      <mode value="target"/>
    </input>
  </group>
  <group>
    <name value="CodeCD"/>
    <extends value="CodeCS"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="code"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="CD"/>
      <mode value="target"/>
    </input>
  </group>
  <group>
    <name value="CodingCE"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="Coding"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="CE"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="code"/>
      <source>
        <context value="src"/>
        <element value="code"/>
        <variable value="code"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="code"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="code"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="system"/>
      <source>
        <context value="src"/>
        <element value="system"/>
        <variable value="system"/>
        <condition value="$this.startsWith('http:')"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="codeSystem"/>
        <transform value="translate"/>
        <parameter>
          <valueId value="system"/>
        </parameter>
        <parameter>
          <valueString value="#uri2oid"/>
        </parameter>
        <parameter>
          <valueString value="code"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="system"/>
      <source>
        <context value="src"/>
        <element value="system"/>
        <variable value="system"/>
        <condition value="$this.startsWith('urn:oid:')"/>
      </source>
      <rule>
        <name value="oidident"/>
        <source>
          <context value="src"/>
          <element value="system"/>
          <variable value="system"/>
        </source>
        <target>
          <context value="tgt"/>
          <contextType value="variable"/>
          <element value="codeSystem"/>
          <transform value="evaluate"/>
          <parameter>
            <valueString value="system.substring(8)"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="systemName1"/>
      <source>
        <context value="src"/>
        <element value="system"/>
        <variable value="system"/>
        <condition value="$this.startsWith('http:')"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="codeSystemName"/>
        <transform value="translate"/>
        <parameter>
          <valueId value="system"/>
        </parameter>
        <parameter>
          <valueString value="#uri2system"/>
        </parameter>
        <parameter>
          <valueString value="code"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="systemName2"/>
      <source>
        <context value="src"/>
        <element value="system"/>
        <variable value="system"/>
        <condition value="$this.startsWith('urn:oid:')"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="codeSystemName"/>
        <transform value="translate"/>
        <parameter>
          <valueId value="system"/>
        </parameter>
        <parameter>
          <valueString value="#oid2system"/>
        </parameter>
        <parameter>
          <valueString value="code"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="display"/>
      <source>
        <context value="src"/>
        <element value="display"/>
        <variable value="display"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="displayName"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="display"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="CodeableConceptCE"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="CodeableConcept"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="CE"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="text"/>
      <source>
        <context value="src"/>
        <element value="text"/>
        <variable value="text"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="orginialText"/>
        <variable value="originalText"/>
      </target>
      <target>
        <context value="originalText"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="text"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="first"/>
      <source>
        <context value="src"/>
        <element value="coding"/>
        <listMode value="first"/>
        <variable value="coding"/>
      </source>
      <dependent>
        <name value="CodingCE"/>
        <variable value="coding">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
        <variable value="tgt">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
      </dependent>
    </rule>
    <rule>
      <name value="translation"/>
      <source>
        <context value="src"/>
        <element value="coding"/>
        <listMode value="not_first"/>
        <variable value="coding"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="translation"/>
        <variable value="translation"/>
      </target>
      <dependent>
        <name value="CodingCE"/>
        <variable value="coding">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
        <variable value="translation">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
      </dependent>
    </rule>
  </group>
  <group>
    <name value="AddressAD"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <documentation value="group CECodeableConcept(source src : CE, target tgt : CodeableConcept) extends Any &lt;&lt;types>> {&#xd;&#xa;src.originalText -> tgt.text;&#xd;&#xa;src -> tgt.coding as coding then {&#xd;&#xa;src.code as code -> coding.code = cast(code, 'string');&#xd;&#xa;src.codeSystem as system -> coding.system = translate(system, 'http://hl7.org/fhir/ConceptMap/special-oid2uri', 'uri');&#xd;&#xa;src.displayName as display -> coding.display = cast(display, 'string');&#xd;&#xa;} &quot;code&quot;;&#xd;&#xa;src.translation as translation -> tgt.coding as coding then {&#xd;&#xa;translation.code as code -> coding.code = cast(code, 'string');&#xd;&#xa;translation.codeSystem as system -> coding.system = translate(system, 'http://hl7.org/fhir/ConceptMap/special-oid2uri', 'uri');&#xd;&#xa;translation.displayName as display -> coding.display = cast(display, 'string');&#xd;&#xa;} &quot;translation&quot;;&#xd;&#xa;}"/>
    <input>
      <name value="src"/>
      <type value="Address"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="AD"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="streetAddress"/>
      <source>
        <context value="src"/>
        <element value="line"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="streetAddressLine"/>
        <variable value="line"/>
      </target>
      <target>
        <context value="line"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="postalCode"/>
      <source>
        <context value="src"/>
        <element value="postalCode"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="postalCode"/>
        <variable value="postalCode"/>
      </target>
      <target>
        <context value="postalCode"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="nullFlavor"/>
      <source>
        <context value="src"/>
        <condition value="$this.postalCode.exists() = false"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="postalCode"/>
        <variable value="postalCode"/>
      </target>
      <target>
        <context value="postalCode"/>
        <contextType value="variable"/>
        <element value="nullFlavor"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="NI"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="city"/>
      <source>
        <context value="src"/>
        <element value="city"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="city"/>
        <variable value="city"/>
      </target>
      <target>
        <context value="city"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="nullFlavor"/>
      <source>
        <context value="src"/>
        <condition value="$this.city.exists() = false"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="city"/>
        <variable value="city"/>
      </target>
      <target>
        <context value="city"/>
        <contextType value="variable"/>
        <element value="nullFlavor"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="NI"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="state"/>
      <source>
        <context value="src"/>
        <element value="state"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="state"/>
        <variable value="state"/>
      </target>
      <target>
        <context value="state"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="district"/>
      <source>
        <context value="src"/>
        <element value="district"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="county"/>
        <variable value="county"/>
      </target>
      <target>
        <context value="county"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="country"/>
      <source>
        <context value="src"/>
        <element value="country"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="country"/>
        <variable value="country"/>
      </target>
      <target>
        <context value="country"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="nullFlavor"/>
      <source>
        <context value="src"/>
        <condition value="$this.country.exists() = false"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="country"/>
        <variable value="country"/>
      </target>
      <target>
        <context value="country"/>
        <contextType value="variable"/>
        <element value="nullFlavor"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="NI"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="addressUse"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="c"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="translate"/>
        <parameter>
          <valueId value="c"/>
        </parameter>
        <parameter>
          <valueString value="#addressUse"/>
        </parameter>
        <parameter>
          <valueString value="code"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="ContactPointTEL"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="ContactPoint"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="TEL"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="value"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="value"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="evaluate"/>
        <parameter>
          <valueString value="iif(%src.system = 'phone', 'tel:', '') + iif(%src.system = 'fax', 'fax:', '') + iif(%src.system = 'email', 'mailto:', '') + iif(%src.system = 'url', 'http:', '') + value"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="use"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="use"/>
        <condition value="$this = 'home'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="HP"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="use"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="use"/>
        <condition value="$this = 'work'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="WP"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="use"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="use"/>
        <condition value="$this = 'old'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="BAD"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="use"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="use"/>
        <condition value="$this = 'temp'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="TMP"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="use"/>
      <source>
        <context value="src"/>
        <element value="use"/>
        <variable value="use"/>
        <condition value="$this = 'mobile'"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="use"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="MC"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="HumanNameEN"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="HumanName"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="EN"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="family"/>
      <source>
        <context value="src"/>
        <element value="family"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="family"/>
        <variable value="family"/>
      </target>
      <target>
        <context value="family"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="given"/>
      <source>
        <context value="src"/>
        <element value="given"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="given"/>
        <variable value="given"/>
      </target>
      <target>
        <context value="given"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CDA-CH prefix"/>
      <source>
        <context value="src"/>
        <element value="prefix"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="prefix"/>
        <variable value="prefix"/>
      </target>
      <target>
        <context value="prefix"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
      <target>
        <context value="prefix"/>
        <contextType value="variable"/>
        <element value="qualifier"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="AC"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="suffix"/>
      <source>
        <context value="src"/>
        <element value="suffix"/>
        <variable value="v"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="suffix"/>
        <variable value="suffix"/>
      </target>
      <target>
        <context value="suffix"/>
        <contextType value="variable"/>
        <element value="data"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="v"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="QuantityPQ"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="Quantity"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="PQ"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="code"/>
      <source>
        <context value="src"/>
        <element value="code"/>
        <variable value="code"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="unit"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="code"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="value"/>
      <source>
        <context value="src"/>
        <element value="value"/>
        <variable value="value"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="copy"/>
        <parameter>
          <valueId value="value"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="RatioRTOPQPQ"/>
    <extends value="Any"/>
    <typeMode value="types"/>
    <input>
      <name value="src"/>
      <type value="Ratio"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="tgt"/>
      <type value="RTO_PQ_PQ"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="numerator"/>
      <source>
        <context value="src"/>
        <element value="numerator"/>
        <variable value="numerator"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="numerator"/>
        <variable value="targetNumerator"/>
      </target>
      <dependent>
        <name value="QuantityPQ"/>
        <variable value="numerator">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
        <variable value="targetNumerator">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
      </dependent>
    </rule>
    <rule>
      <name value="denominator"/>
      <source>
        <context value="src"/>
        <element value="denominator"/>
        <variable value="denominator"/>
      </source>
      <target>
        <context value="tgt"/>
        <contextType value="variable"/>
        <element value="denominator"/>
        <variable value="targetDenominator"/>
      </target>
      <dependent>
        <name value="QuantityPQ"/>
        <variable value="denominator">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
        <variable value="targetDenominator">
          <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
            <valueUrl value="id"/>
          </extension>
        </variable>
      </dependent>
    </rule>
  </group>
</StructureMap>