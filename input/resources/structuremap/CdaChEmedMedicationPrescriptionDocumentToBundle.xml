<StructureMap xmlns="http://hl7.org/fhir">
   <id value="CdaChEmedMedicationPrescriptionDocumentToBundle"></id>
   <text>
      <status value="generated"></status>
      <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChEmedMedicationPrescriptionDocumentToBundle" = "CdaChEmedMedicationPrescriptionDocumentToFhirBundle"

uses "http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument" alias ClinicalDocument as source
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor" alias AssignedAuthor as source
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity" alias AssignedEntity as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Author" alias Author as source
uses "http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization" alias CustodianOrganization as source
uses "http://hl7.org/fhir/cda/StructureDefinition/IVL_TS" alias IVL_TS as source
uses "http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS" alias EIVL_TS as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Observation" alias Observation as source
uses "http://hl7.org/fhir/cda/StructureDefinition/PatientRole" alias PatientRole as source
uses "http://hl7.org/fhir/cda/StructureDefinition/RecordTarget" alias RecordTarget as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Section" alias Section as source
uses "http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration" alias SubstanceAdministration as source
uses "http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS" alias SXPR_TS as source
uses "http://hl7.org/fhir/StructureDefinition/Bundle" alias Bundle as target
uses "http://hl7.org/fhir/StructureDefinition/Composition" alias Composition as produced
uses "http://hl7.org/fhir/StructureDefinition/Patient" alias Patient as produced
uses "http://hl7.org/fhir/StructureDefinition/Practitioner" alias Practitioner as produced
uses "http://hl7.org/fhir/StructureDefinition/Organization" alias Organization as produced
uses "http://hl7.org/fhir/StructureDefinition/MedicationRequest" alias MedicationRequest as produced
uses "http://hl7.org/fhir/StructureDefinition/Dosage" alias Dosage as produced

imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle"

group CdaChEmedMedicationPrescriptionDocumentToBundle(source cda : ClinicalDocument, target bundle : Bundle) {
  cda -&gt;  bundle.entry as e share e,  e.resource = create('Composition') as composition share composition,  composition.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  bundle.entry as e2,  e2.resource = create('Patient') as patient share patient,  patient.id = uuid() as uuid2,  e2.fullUrl = append('urn:uuid:', uuid2) then ClinicalDocumentChEmedMedicationPrescriptionDocumentToBundle(cda, patient, composition, bundle) "ClinicalDocumentToBody";
}

group ClinicalDocumentChEmedMedicationPrescriptionDocumentToBundle(source cda : ClinicalDocument, target patient : Patient, target composition : Composition, target bundle : Bundle) extends ClinicalDocumentChToBundle {
  cda.component as component then {
    component.structuredBody as body then {
      body.component as component then {
        component.section as srcSection where (templateId.where(root = '2.16.756.5.30.1.1.10.3.10')) -&gt; composition.section as tgtSection then SectionPrescriptionSectionContentModule(srcSection, patient, tgtSection, bundle);
      };
    } "body";
  };
}

group SectionPrescriptionSectionContentModule(source src : Section, source patient : Patient, target tgt, target bundle : Bundle) extends ClinicalDocumentSection {
  src.entry as cdaEntry -&gt;  bundle.entry as e,  e.resource = create('MedicationRequest') as medicationrequest,  medicationrequest.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  tgt.entry = create('Reference') as reference,  reference.reference = reference(medicationrequest) then {
    cdaEntry.substanceAdministration as substanceAdministration then PrescriptionItemEntryContentModule(src, substanceAdministration, patient, medicationrequest);
  } "cdaEntry";
}

group AnnotationComment(source section : Section, source act : Act, target note : Annotation) {
  act -&gt; note.text = ("%section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&gt;') - 1)") "idRef";
  act.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; note.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
}

group Substitution(source act : Act, target medicationRequest : MedicationRequest) {
  act -&gt; medicationRequest.substitution as substitution then {
    act.code as actCode -&gt;  substitution.allowed = create('CodeableConcept') as allowedCC,  allowedCC.coding as coding then {
      actCode -&gt;  coding.system as systemCC,  systemCC.value = 'http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution' "system";
      actCode.code as code -&gt;  coding.code as codeCC,  codeCC.value = code;
      actCode.displayName as display -&gt;  coding.display as displayCC,  displayCC.value = display "display";
    } "allowedCC";
  } "substitution";
}

group PrescribedQuantity(source supply : Supply, target medicationRequest : MedicationRequest) {
  supply.quantity as quantity -&gt;  medicationRequest.dispenseRequest as dispenseRequest,  dispenseRequest.quantity as quant then {
    quantity.value as value -&gt; quant.value = value;
    quantity.unit as unit then {
      unit -&gt; quant.unit = unit "unit";
      unit -&gt; quant.system = 'http://unitsofmeasure.org' "ucum";
      unit -&gt; quant.code = unit "code";
    };
  };
}

group ManufacturedMaterialEntryContentModule(source src : SubstanceAdministration, target medicationRequest : MedicationRequest, target medication : Medication) {
  src -&gt;  medication.id = 'med',  medicationRequest.medication = create('Reference') as vt,  vt.reference = '#med' "medication";
  src.consumable as consumable then {
    consumable.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.code as code then {
          code.originalText as text then {
            text.reference as reference -&gt; medication.code as medCode then {
              reference.value as value -&gt; medCode.extension as ext then NarrativeLink(value, ext) "narrativeLink";
            };
          } "text";
        };
        manufacturedMaterial.asContent as asContent then {
          asContent.containerPackagedMedicine as containerPackagedMedicine then {
            containerPackagedMedicine.code as code -&gt;  medication.code as fhircode,  fhircode.text = ("%manufacturedMaterial.name.other") then CECodeableConcept(code, fhircode);
            containerPackagedMedicine.formCode as formCode -&gt; medication.form as form then CECodeableConcept(formCode, form);
            containerPackagedMedicine.capacityQuantity as capacityQuantity where (%containerPackagedMedicine.formCode.code = '10219000') -&gt; medication.amount = create('Ratio') as ratio then {
              capacityQuantity where $this.unit.exists() = false then {
                capacityQuantity.value as value -&gt;  ratio.numerator = create('Quantity') as quantity,  quantity.value = value,  ratio.denominator = create('Quantity') as denominator,  denominator.value = '1' "capacityQuantity";
              } "noUnit";
              capacityQuantity where $this.unit.exists() then {
                capacityQuantity.unit as unit then {
                  capacityQuantity.value as value -&gt;  ratio.numerator = create('Quantity') as quantity,  quantity.value = value,  quantity.unit = unit,  quantity.system = 'http://unitsofmeasure.org',  quantity.code = unit,  ratio.denominator = create('Quantity') as denominator,  denominator.value = '1',  denominator.unit = 'Package',  denominator.system = 'http://unitsofmeasure.org',  denominator.code = '1' "capacityQuantity";
                } "capQuantUnit";
              } "unit";
            } "ratio";
          };
        };
        manufacturedMaterial.ingredient as ingredient -&gt; medication.ingredient as ing then {
          ingredient.quantity as quantity -&gt; ing.strength = create('Ratio') as strength then RTOPQPQRatio(quantity, strength) "strength";
          ingredient.ingredient as medingredient then {
            medingredient.code as code -&gt;  ing.item = create('CodeableConcept') as ingcode,  ingcode.text = ("%medingredient.name.other") then CECodeableConcept(code, ingcode) "ingredientCode";
          };
        };
      };
    };
    src where $this.entryRelationship.sequenceNumber.exists() = false -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsStartStopFrequency(src, dosage) "dosage";
  };
}

group PrescriptionItemEntryContentModule(source section : Section, source src : SubstanceAdministration, source patient : Patient, target medicationRequest : MedicationRequest) {
  src.id -&gt; medicationRequest.identifier;
  patient -&gt;  medicationRequest.subject = create('Reference') as reference,  reference.reference = reference(patient) "patient";
  src -&gt; medicationRequest.status = 'completed' "completed";
  src -&gt; medicationRequest.intent = 'order' "order";
  src.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; medicationRequest.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
  src -&gt; medicationRequest.contained = create('Medication') as medication then ManufacturedMaterialEntryContentModule(src, medicationRequest, medication) "medication";
  src.entryRelationship as entry where typeCode = 'RSON' then {
    entry.observation as observation -&gt; medicationRequest.reasonCode as reasonCode then TreatmentReasonEntryContentModule(section, observation, reasonCode) "reasonCode";
  } "41";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.37')) -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsNonStructuredEntryContentModule(section, entry, dosage) "37";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0)) -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsEntryDosageChange(src, entry, dosage) "36";
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists()) -&gt; medicationRequest.extension as ext then MTPReferenceEntryContentModule(entry, ext) "MTPReferenceEntry";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists()) then {
    entry.act as act -&gt; medicationRequest.note as note then AnnotationComment(section, act, note) "annotation";
  } "2";
  src.repeatNumber as repeatNumber -&gt; medicationRequest.dispenseRequest as dispenseRequest then {
    repeatNumber -&gt; dispenseRequest.numberOfRepeatsAllowed = repeatNumber "repeatNumber";
  } "repeats";
  src.entryRelationship as entry where ((typeCode = 'COMP') and supply.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.8').exists()) then {
    entry.supply as supply -&gt; medicationRequest as medicationRequest then PrescribedQuantity(supply, medicationRequest) "quantity";
  } "8";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists()) then {
    entry.act as act -&gt; medicationRequest as medicationRequest then Substitution(act, medicationRequest) "substitution";
  } "1";
}

group DosageInstructionsStartStopFrequency(source src : SubstanceAdministration, target dosage : Dosage) {
  src.templateId as templateId where $this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' -&gt; dosage.extension as ext then {
    src -&gt; ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-dosagetype' "url";
    src -&gt; ext.value = create('Identifier') as valueIdentifier then {
      templateId.root as id -&gt; valueIdentifier.value = id "normalDosing";
    } "valueIdentifier";
  } "extension";
  src as src -&gt; dosage as dosage then EffectiveTimeStartEnd(src, dosage) "effectiveTimeStartEnd";
  src as src -&gt; dosage as dosage then EffectiveTimeWhen(src, dosage) "effectiveTimeWhen";
  src.routeCode as routeCode -&gt; dosage.route as route then CECodeableConcept(routeCode, route);
  src as src -&gt; dosage as dosage then DoseQuantity(src, dosage) "doseQuantity";
}

group DosageInstructionsEntryDosageChange(source src : substanceAdministration, source entry : entryRelationship, target dosage : Dosage) {
  src.templateId as templateId where (($this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.9') or ($this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.8')) -&gt; dosage.extension as ext then {
    src -&gt; ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-dosagetype' "url";
    soursrcce -&gt; ext.value = create('Identifier') as valueIdentifier then {
      templateId.root as id -&gt; valueIdentifier.value = id "dosingType";
    } "valueIdentifier";
  } "extension";
  entry.sequenceNumber as sequenceNumber -&gt; dosage.sequence = sequenceNumber;
  src as src -&gt; dosage as dosage then EffectiveTimeStartEnd(src, dosage) "effectiveTimeStartEnd";
  entry.substanceAdministration as src -&gt; dosage as dosage then EffectiveTimeWhen(src, dosage) "effectiveTimeWhen";
  src.routeCode as routeCode -&gt; dosage.route as route then CECodeableConcept(routeCode, route);
  entry.substanceAdministration as src -&gt; dosage as dosage then DoseQuantity(src, dosage) "doseQuantity";
}

group EffectiveTimeStartEnd(source src : substanceAdministration, target dosage : Dosage) {
  src.effectiveTime : IVL_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime -&gt; repeat.bounds = create('Period') as period then {
        effectiveTime.low as low then {
          low.value as lowDate -&gt; period.start = lowDate "lowDate";
        };
        effectiveTime.high as high then {
          high.value as highDate -&gt; period.end = highDate "highDate";
        };
      } "period";
    } "repeat";
  } "effectiveTime-IVL-TS";
}

group EffectiveTimeWhen(source src : substanceAdministration, target dosage : Dosage) {
  src.effectiveTime : EIVL_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime.event as event then {
        event.code as code -&gt; repeat.when = code;
      };
    } "repeat";
  } "effectiveTime-EIVL-TS";
  src.effectiveTime : SXPR_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime.comp as comp then {
        comp.event as event then {
          event.code as code -&gt; repeat.when = code;
        };
      };
    } "repeat";
  } "effectiveTime-SXPR-TS";
}

group DoseQuantity(source src : substanceAdministration, target dosage : Dosage) {
  src.doseQuantity as doseQuantity -&gt; dosage.doseAndRate as doseAndRate then {
    doseQuantity.center as center -&gt; doseAndRate.dose = create('Quantity') as quantity then {
      center.value as value -&gt; quantity.value = value;
    } "quantity";
  };
}

group TreatmentReasonEntryContentModule(source section : Section, source observation : Observation, target reasonCode : Coding) {
  observation -&gt; reasonCode.text = ("%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') - 1)") "idRef";
  observation.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; reasonCode.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
}

group MTPReferenceEntryContentModule(source entryrelationship, target ext : Extension) {
  entryrelationship -&gt; ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' "url";
  entryrelationship.substanceAdministration as substanceAdministration then {
    substanceAdministration.id as id -&gt; ext.extension as ext then InnerExtensionId(id, ext) "innerExtensionId";
    substanceAdministration.reference as reference then {
      reference.externalDocument as externalDocument then {
        externalDocument.id as id -&gt; ext.extension as ext then InnerExtensionExternalDocumentId(id, ext) "innerExtensionExternalDocumentId";
      };
    } "substanceAdministration";
  } "id";
}

group DosageInstructionsNonStructuredEntryContentModule(source section : Section, source entry : Element, target dosage : Dosage) {
  entry.substanceAdministration as observation -&gt; dosage.text = ("%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') - 1)") "idRef";
  entry.substanceAdministration as observation then {
    observation.text as text then {
      text.reference as reference then {
        reference.value as value -&gt; dosage.extension as ext then NarrativeLink(value, ext) "narrativeLink";
      };
    };
  } "observation";
}

group InnerExtensionExternalDocumentId(source src, target ext : Extension) {
  src -&gt; ext.url = 'externalDocumentId' "url";
  src -&gt; ext.value = create('Identifier') as id then II(src, id) "value";
}

group InnerExtensionId(source src, target ext : Extension) {
  src -&gt; ext.url = 'id' "url";
  src -&gt; ext.value = create('Identifier') as id then II(src, id) "value";
}

         </pre>
      </div>
   </text>
   <url value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChEmedMedicationPrescriptionDocumentToBundle"></url>
   <name value="CdaChEmedMedicationPrescriptionDocumentToFhirBundle"></name>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument"></url>
      <mode value="source"></mode>
      <alias value="ClinicalDocument"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor"></url>
      <mode value="source"></mode>
      <alias value="AssignedAuthor"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity"></url>
      <mode value="source"></mode>
      <alias value="AssignedEntity"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Author"></url>
      <mode value="source"></mode>
      <alias value="Author"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization"></url>
      <mode value="source"></mode>
      <alias value="CustodianOrganization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/IVL_TS"></url>
      <mode value="source"></mode>
      <alias value="IVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS"></url>
      <mode value="source"></mode>
      <alias value="EIVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Observation"></url>
      <mode value="source"></mode>
      <alias value="Observation"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PatientRole"></url>
      <mode value="source"></mode>
      <alias value="PatientRole"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/RecordTarget"></url>
      <mode value="source"></mode>
      <alias value="RecordTarget"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Section"></url>
      <mode value="source"></mode>
      <alias value="Section"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration"></url>
      <mode value="source"></mode>
      <alias value="SubstanceAdministration"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS"></url>
      <mode value="source"></mode>
      <alias value="SXPR_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Bundle"></url>
      <mode value="target"></mode>
      <alias value="Bundle"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Composition"></url>
      <mode value="produced"></mode>
      <alias value="Composition"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Patient"></url>
      <mode value="produced"></mode>
      <alias value="Patient"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"></url>
      <mode value="produced"></mode>
      <alias value="Practitioner"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Organization"></url>
      <mode value="produced"></mode>
      <alias value="Organization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/MedicationRequest"></url>
      <mode value="produced"></mode>
      <alias value="MedicationRequest"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Dosage"></url>
      <mode value="produced"></mode>
      <alias value="Dosage"></alias>
   </structure>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle"></import>
   <group>
      <name value="CdaChEmedMedicationPrescriptionDocumentToBundle"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="cda"></name>
         <type value="ClinicalDocument"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ClinicalDocumentToBody"></name>
         <source>
            <context value="cda"></context>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="e"></listRuleId>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="composition"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="composition"></listRuleId>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Composition"></valueString>
            </parameter>
         </target>
         <target>
            <context value="composition"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e2"></variable>
         </target>
         <target>
            <context value="e2"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="patient"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="patient"></listRuleId>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Patient"></valueString>
            </parameter>
         </target>
         <target>
            <context value="patient"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid2"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e2"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid2"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="ClinicalDocumentChEmedMedicationPrescriptionDocumentToBundle"></name>
            <variable value="cda"></variable>
            <variable value="patient"></variable>
            <variable value="composition"></variable>
            <variable value="bundle"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ClinicalDocumentChEmedMedicationPrescriptionDocumentToBundle"></name>
      <extends value="ClinicalDocumentChToBundle"></extends>
      <typeMode value="none"></typeMode>
      <input>
         <name value="cda"></name>
         <type value="ClinicalDocument"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="composition"></name>
         <type value="Composition"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="component"></name>
         <source>
            <context value="cda"></context>
            <element value="component"></element>
            <variable value="component"></variable>
         </source>
         <rule>
            <name value="body"></name>
            <source>
               <context value="component"></context>
               <element value="structuredBody"></element>
               <variable value="body"></variable>
            </source>
            <rule>
               <name value="component"></name>
               <source>
                  <context value="body"></context>
                  <element value="component"></element>
                  <variable value="component"></variable>
               </source>
               <rule>
                  <name value="section"></name>
                  <source>
                     <context value="component"></context>
                     <element value="section"></element>
                     <variable value="srcSection"></variable>
                     <condition value="(templateId.where(root = '2.16.756.5.30.1.1.10.3.10'))"></condition>
                  </source>
                  <target>
                     <context value="composition"></context>
                     <contextType value="variable"></contextType>
                     <element value="section"></element>
                     <variable value="tgtSection"></variable>
                  </target>
                  <dependent>
                     <name value="SectionPrescriptionSectionContentModule"></name>
                     <variable value="srcSection"></variable>
                     <variable value="patient"></variable>
                     <variable value="tgtSection"></variable>
                     <variable value="bundle"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="SectionPrescriptionSectionContentModule"></name>
      <extends value="ClinicalDocumentSection"></extends>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="tgt"></name>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="cdaEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entry"></element>
            <variable value="cdaEntry"></variable>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="medicationrequest"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="MedicationRequest"></valueString>
            </parameter>
         </target>
         <target>
            <context value="medicationrequest"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="reference"></transform>
            <parameter>
               <valueId value="medicationrequest"></valueId>
            </parameter>
         </target>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="cdaEntry"></context>
               <element value="substanceAdministration"></element>
               <variable value="substanceAdministration"></variable>
            </source>
            <dependent>
               <name value="PrescriptionItemEntryContentModule"></name>
               <variable value="src"></variable>
               <variable value="substanceAdministration"></variable>
               <variable value="patient"></variable>
               <variable value="medicationrequest"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="AnnotationComment"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="note"></name>
         <type value="Annotation"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="idRef"></name>
         <source>
            <context value="act"></context>
         </source>
         <target>
            <context value="note"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="%section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%act.text.reference.value.substring(1))).indexOf('&gt;') - 1)"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="act"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="note"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="Substitution"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="substitution"></name>
         <source>
            <context value="act"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="substitution"></element>
            <variable value="substitution"></variable>
         </target>
         <rule>
            <name value="allowedCC"></name>
            <source>
               <context value="act"></context>
               <element value="code"></element>
               <variable value="actCode"></variable>
            </source>
            <target>
               <context value="substitution"></context>
               <contextType value="variable"></contextType>
               <element value="allowed"></element>
               <variable value="allowedCC"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="CodeableConcept"></valueString>
               </parameter>
            </target>
            <target>
               <context value="allowedCC"></context>
               <contextType value="variable"></contextType>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </target>
            <rule>
               <name value="system"></name>
               <source>
                  <context value="actCode"></context>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <variable value="systemCC"></variable>
               </target>
               <target>
                  <context value="systemCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="code"></element>
                  <variable value="code"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <variable value="codeCC"></variable>
               </target>
               <target>
                  <context value="codeCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="code"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="display"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="displayName"></element>
                  <variable value="display"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="display"></element>
                  <variable value="displayCC"></variable>
               </target>
               <target>
                  <context value="displayCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="display"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <documentation value="act.code as code -&gt; substitution.allowed = create('CodeableConcept') as allowedCC then CECodeableConcept(code, allowedCC) &quot;allowedCC&quot;;"></documentation>
      </rule>
   </group>
   <group>
      <name value="PrescribedQuantity"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="supply"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dispenseRequest"></element>
            <variable value="dispenseRequest"></variable>
         </target>
         <target>
            <context value="dispenseRequest"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="quant"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="quant"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="unit"></name>
            <source>
               <context value="quantity"></context>
               <element value="unit"></element>
               <variable value="unit"></variable>
            </source>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="unit"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="ucum"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://unitsofmeasure.org"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <documentation value="IHE-PRE: If the product-element contains package information, the unit attribute is not be present"></documentation>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medication"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="med"></valueString>
            </parameter>
         </target>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="medication"></element>
            <variable value="vt"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="vt"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="#med"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="src"></context>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </source>
         <rule>
            <name value="manufacturedProduct"></name>
            <source>
               <context value="consumable"></context>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </source>
            <rule>
               <name value="manufacturedMaterial"></name>
               <source>
                  <context value="manufacturedProduct"></context>
                  <element value="manufacturedMaterial"></element>
                  <variable value="manufacturedMaterial"></variable>
               </source>
               <rule>
                  <name value="code"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="code"></element>
                     <variable value="code"></variable>
                  </source>
                  <rule>
                     <name value="text"></name>
                     <source>
                        <context value="code"></context>
                        <element value="originalText"></element>
                        <variable value="text"></variable>
                     </source>
                     <rule>
                        <name value="reference"></name>
                        <source>
                           <context value="text"></context>
                           <element value="reference"></element>
                           <variable value="reference"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="medCode"></variable>
                        </target>
                        <rule>
                           <name value="narrativeLink"></name>
                           <source>
                              <context value="reference"></context>
                              <element value="value"></element>
                              <variable value="value"></variable>
                           </source>
                           <target>
                              <context value="medCode"></context>
                              <contextType value="variable"></contextType>
                              <element value="extension"></element>
                              <variable value="ext"></variable>
                           </target>
                           <dependent>
                              <name value="NarrativeLink"></name>
                              <variable value="value"></variable>
                              <variable value="ext"></variable>
                           </dependent>
                        </rule>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="asContent"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="asContent"></element>
                     <variable value="asContent"></variable>
                  </source>
                  <rule>
                     <name value="containerPackagedMedicine"></name>
                     <source>
                        <context value="asContent"></context>
                        <element value="containerPackagedMedicine"></element>
                        <variable value="containerPackagedMedicine"></variable>
                     </source>
                     <rule>
                        <name value="medication.code"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                        </target>
                        <target>
                           <context value="fhircode"></context>
                           <contextType value="variable"></contextType>
                           <element value="text"></element>
                           <transform value="evaluate"></transform>
                           <parameter>
                              <valueString value="%manufacturedMaterial.name.other"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="fhircode"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="medication.formCode"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="formCode"></element>
                           <variable value="formCode"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="form"></element>
                           <variable value="form"></variable>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="formCode"></variable>
                           <variable value="form"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="ratio"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="capacityQuantity"></element>
                           <variable value="capacityQuantity"></variable>
                           <condition value="(%containerPackagedMedicine.formCode.code = '10219000')"></condition>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="amount"></element>
                           <variable value="ratio"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Ratio"></valueString>
                           </parameter>
                        </target>
                        <rule>
                           <name value="noUnit"></name>
                           <source>
                              <context value="capacityQuantity"></context>
                              <condition value="$this.unit.exists() = false"></condition>
                           </source>
                           <rule>
                              <name value="capacityQuantity"></name>
                              <source>
                                 <context value="capacityQuantity"></context>
                                 <element value="value"></element>
                                 <variable value="value"></variable>
                              </source>
                              <target>
                                 <context value="ratio"></context>
                                 <contextType value="variable"></contextType>
                                 <element value="numerator"></element>
                                 <variable value="quantity"></variable>
                                 <transform value="create"></transform>
                                 <parameter>
                                    <valueString value="Quantity"></valueString>
                                 </parameter>
                              </target>
                              <target>
                                 <context value="quantity"></context>
                                 <contextType value="variable"></contextType>
                                 <element value="value"></element>
                                 <transform value="copy"></transform>
                                 <parameter>
                                    <valueId value="value"></valueId>
                                 </parameter>
                              </target>
                              <target>
                                 <context value="ratio"></context>
                                 <contextType value="variable"></contextType>
                                 <element value="denominator"></element>
                                 <variable value="denominator"></variable>
                                 <transform value="create"></transform>
                                 <parameter>
                                    <valueString value="Quantity"></valueString>
                                 </parameter>
                              </target>
                              <target>
                                 <context value="denominator"></context>
                                 <contextType value="variable"></contextType>
                                 <element value="value"></element>
                                 <transform value="copy"></transform>
                                 <parameter>
                                    <valueString value="1"></valueString>
                                 </parameter>
                              </target>
                           </rule>
                        </rule>
                        <rule>
                           <name value="unit"></name>
                           <source>
                              <context value="capacityQuantity"></context>
                              <condition value="$this.unit.exists()"></condition>
                           </source>
                           <rule>
                              <name value="capQuantUnit"></name>
                              <source>
                                 <context value="capacityQuantity"></context>
                                 <element value="unit"></element>
                                 <variable value="unit"></variable>
                              </source>
                              <rule>
                                 <name value="capacityQuantity"></name>
                                 <source>
                                    <context value="capacityQuantity"></context>
                                    <element value="value"></element>
                                    <variable value="value"></variable>
                                 </source>
                                 <target>
                                    <context value="ratio"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="numerator"></element>
                                    <variable value="quantity"></variable>
                                    <transform value="create"></transform>
                                    <parameter>
                                       <valueString value="Quantity"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="quantity"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="value"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueId value="value"></valueId>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="quantity"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="unit"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueId value="unit"></valueId>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="quantity"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="system"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueString value="http://unitsofmeasure.org"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="quantity"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="code"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueId value="unit"></valueId>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="ratio"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="denominator"></element>
                                    <variable value="denominator"></variable>
                                    <transform value="create"></transform>
                                    <parameter>
                                       <valueString value="Quantity"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="denominator"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="value"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueString value="1"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="denominator"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="unit"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueString value="Package"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="denominator"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="system"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueString value="http://unitsofmeasure.org"></valueString>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="denominator"></context>
                                    <contextType value="variable"></contextType>
                                    <element value="code"></element>
                                    <transform value="copy"></transform>
                                    <parameter>
                                       <valueString value="1"></valueString>
                                    </parameter>
                                 </target>
                              </rule>
                           </rule>
                        </rule>
                        <documentation value="IHE: Case 1: If the capacityQuantity is given in countable units, the unit attribute SHALL NOT be present"></documentation>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="ingredient"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="ingredient"></element>
                     <variable value="ingredient"></variable>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="ingredient"></element>
                     <variable value="ing"></variable>
                  </target>
                  <rule>
                     <name value="strength"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="quantity"></element>
                        <variable value="quantity"></variable>
                     </source>
                     <target>
                        <context value="ing"></context>
                        <contextType value="variable"></contextType>
                        <element value="strength"></element>
                        <variable value="strength"></variable>
                        <transform value="create"></transform>
                        <parameter>
                           <valueString value="Ratio"></valueString>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="RTOPQPQRatio"></name>
                        <variable value="quantity"></variable>
                        <variable value="strength"></variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="ingredient.ingredient"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="ingredient"></element>
                        <variable value="medingredient"></variable>
                     </source>
                     <rule>
                        <name value="ingredientCode"></name>
                        <source>
                           <context value="medingredient"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="ing"></context>
                           <contextType value="variable"></contextType>
                           <element value="item"></element>
                           <variable value="ingcode"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="CodeableConcept"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ingcode"></context>
                           <contextType value="variable"></contextType>
                           <element value="text"></element>
                           <transform value="evaluate"></transform>
                           <parameter>
                              <valueString value="%medingredient.name.other"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="ingcode"></variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
               <documentation value="#pre.no.brandedmedication"></documentation>
            </rule>
         </rule>
         <rule>
            <name value="dosage"></name>
            <source>
               <context value="src"></context>
               <condition value="$this.entryRelationship.sequenceNumber.exists() = false"></condition>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="dosageInstruction"></element>
               <variable value="dosage"></variable>
            </target>
            <dependent>
               <name value="DosageInstructionsStartStopFrequency"></name>
               <variable value="src"></variable>
               <variable value="dosage"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="PrescriptionItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="id"></name>
         <source>
            <context value="src"></context>
            <element value="id"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="identifier"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
      </rule>
      <rule>
         <name value="patient"></name>
         <source>
            <context value="patient"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="subject"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="reference"></transform>
            <parameter>
               <valueId value="patient"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="completed"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="status"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="order"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="intent"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="order"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="src"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="medicationRequest"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Medication"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="ManufacturedMaterialEntryContentModule"></name>
            <variable value="src"></variable>
            <variable value="medicationRequest"></variable>
            <variable value="medication"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.41"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="typeCode = 'RSON'"></condition>
         </source>
         <rule>
            <name value="reasonCode"></name>
            <source>
               <context value="entry"></context>
               <element value="observation"></element>
               <variable value="observation"></variable>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="reasonCode"></element>
               <variable value="reasonCode"></variable>
            </target>
            <dependent>
               <name value="TreatmentReasonEntryContentModule"></name>
               <variable value="section"></variable>
               <variable value="observation"></variable>
               <variable value="reasonCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.37"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.37'))"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="section"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.36"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0))"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryDosageChange"></name>
            <variable value="src"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="MTPReferenceEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists())"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="entry"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.2"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists())"></condition>
         </source>
         <rule>
            <name value="annotation"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="note"></element>
               <variable value="note"></variable>
            </target>
            <dependent>
               <name value="AnnotationComment"></name>
               <variable value="section"></variable>
               <variable value="act"></variable>
               <variable value="note"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="repeats"></name>
         <source>
            <context value="src"></context>
            <element value="repeatNumber"></element>
            <variable value="repeatNumber"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dispenseRequest"></element>
            <variable value="dispenseRequest"></variable>
         </target>
         <rule>
            <name value="repeatNumber"></name>
            <source>
               <context value="repeatNumber"></context>
            </source>
            <target>
               <context value="dispenseRequest"></context>
               <contextType value="variable"></contextType>
               <element value="numberOfRepeatsAllowed"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="repeatNumber"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.8"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and supply.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.8').exists())"></condition>
         </source>
         <rule>
            <name value="quantity"></name>
            <source>
               <context value="entry"></context>
               <element value="supply"></element>
               <variable value="supply"></variable>
            </source>
            <target>
               <variable value="medicationRequest"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationRequest"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="PrescribedQuantity"></name>
               <variable value="supply"></variable>
               <variable value="medicationRequest"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.9.1"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists())"></condition>
         </source>
         <rule>
            <name value="substitution"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <variable value="medicationRequest"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationRequest"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="Substitution"></name>
               <variable value="act"></variable>
               <variable value="medicationRequest"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsStartStopFrequency"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="extension"></name>
         <source>
            <context value="src"></context>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
            <condition value="$this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1'"></condition>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <rule>
            <name value="url"></name>
            <source>
               <context value="src"></context>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="url"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-dosagetype"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="valueIdentifier"></name>
            <source>
               <context value="src"></context>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <variable value="valueIdentifier"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="Identifier"></valueString>
               </parameter>
            </target>
            <rule>
               <name value="normalDosing"></name>
               <source>
                  <context value="templateId"></context>
                  <element value="root"></element>
                  <variable value="id"></variable>
               </source>
               <target>
                  <context value="valueIdentifier"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="id"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="effectiveTimeWhen"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeWhen"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="routeCode"></name>
         <source>
            <context value="src"></context>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="route"></element>
            <variable value="route"></variable>
         </target>
         <dependent>
            <name value="CECodeableConcept"></name>
            <variable value="routeCode"></variable>
            <variable value="route"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="DoseQuantity"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryDosageChange"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="entryRelationship"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="extension"></name>
         <source>
            <context value="src"></context>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
            <condition value="(($this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.9') or ($this.root = '1.3.6.1.4.1.19376.1.5.3.1.4.8'))"></condition>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <rule>
            <name value="url"></name>
            <source>
               <context value="src"></context>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="url"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-dosagetype"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="valueIdentifier"></name>
            <source>
               <context value="soursrcce"></context>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <variable value="valueIdentifier"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="Identifier"></valueString>
               </parameter>
            </target>
            <rule>
               <name value="dosingType"></name>
               <source>
                  <context value="templateId"></context>
                  <element value="root"></element>
                  <variable value="id"></variable>
               </source>
               <target>
                  <context value="valueIdentifier"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="id"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="sequenceNumber"></name>
         <source>
            <context value="entry"></context>
            <element value="sequenceNumber"></element>
            <variable value="sequenceNumber"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="sequence"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="sequenceNumber"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="effectiveTimeWhen"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeWhen"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="routeCode"></name>
         <source>
            <context value="src"></context>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="route"></element>
            <variable value="route"></variable>
         </target>
         <dependent>
            <name value="CECodeableConcept"></name>
            <variable value="routeCode"></variable>
            <variable value="route"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="DoseQuantity"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeStartEnd"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="effectiveTime-IVL-TS"></name>
         <source>
            <context value="src"></context>
            <type value="IVL_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="period"></name>
               <source>
                  <context value="effectiveTime"></context>
               </source>
               <target>
                  <context value="repeat"></context>
                  <contextType value="variable"></contextType>
                  <element value="bounds"></element>
                  <variable value="period"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="Period"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="low"></name>
                  <source>
                     <context value="effectiveTime"></context>
                     <element value="low"></element>
                     <variable value="low"></variable>
                  </source>
                  <rule>
                     <name value="lowDate"></name>
                     <source>
                        <context value="low"></context>
                        <element value="value"></element>
                        <variable value="lowDate"></variable>
                     </source>
                     <target>
                        <context value="period"></context>
                        <contextType value="variable"></contextType>
                        <element value="start"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="lowDate"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="high"></name>
                  <source>
                     <context value="effectiveTime"></context>
                     <element value="high"></element>
                     <variable value="high"></variable>
                  </source>
                  <rule>
                     <name value="highDate"></name>
                     <source>
                        <context value="high"></context>
                        <element value="value"></element>
                        <variable value="highDate"></variable>
                     </source>
                     <target>
                        <context value="period"></context>
                        <contextType value="variable"></contextType>
                        <element value="end"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="highDate"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeWhen"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="effectiveTime-EIVL-TS"></name>
         <source>
            <context value="src"></context>
            <type value="EIVL_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="event"></name>
               <source>
                  <context value="effectiveTime"></context>
                  <element value="event"></element>
                  <variable value="event"></variable>
               </source>
               <rule>
                  <name value="code"></name>
                  <source>
                     <context value="event"></context>
                     <element value="code"></element>
                     <variable value="code"></variable>
                  </source>
                  <target>
                     <context value="repeat"></context>
                     <contextType value="variable"></contextType>
                     <element value="when"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="code"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="effectiveTime-SXPR-TS"></name>
         <source>
            <context value="src"></context>
            <type value="SXPR_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="comp"></name>
               <source>
                  <context value="effectiveTime"></context>
                  <element value="comp"></element>
                  <variable value="comp"></variable>
               </source>
               <rule>
                  <name value="event"></name>
                  <source>
                     <context value="comp"></context>
                     <element value="event"></element>
                     <variable value="event"></variable>
                  </source>
                  <rule>
                     <name value="code"></name>
                     <source>
                        <context value="event"></context>
                        <element value="code"></element>
                        <variable value="code"></variable>
                     </source>
                     <target>
                        <context value="repeat"></context>
                        <contextType value="variable"></contextType>
                        <element value="when"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="code"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DoseQuantity"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="src"></context>
            <element value="doseQuantity"></element>
            <variable value="doseQuantity"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="doseAndRate"></element>
            <variable value="doseAndRate"></variable>
         </target>
         <rule>
            <name value="quantity"></name>
            <source>
               <context value="doseQuantity"></context>
               <element value="center"></element>
               <variable value="center"></variable>
            </source>
            <target>
               <context value="doseAndRate"></context>
               <contextType value="variable"></contextType>
               <element value="dose"></element>
               <variable value="quantity"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="Quantity"></valueString>
               </parameter>
            </target>
            <rule>
               <name value="value"></name>
               <source>
                  <context value="center"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="quantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="value"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="TreatmentReasonEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="observation"></name>
         <type value="Observation"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="reasonCode"></name>
         <type value="Coding"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="idRef"></name>
         <source>
            <context value="observation"></context>
         </source>
         <target>
            <context value="reasonCode"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') - 1)"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="observation"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="reasonCode"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="MTPReferenceEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="entryrelationship"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="entryrelationship"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="entryrelationship"></context>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </source>
         <rule>
            <name value="innerExtensionId"></name>
            <source>
               <context value="substanceAdministration"></context>
               <element value="id"></element>
               <variable value="id"></variable>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="extension"></element>
               <variable value="ext"></variable>
            </target>
            <dependent>
               <name value="InnerExtensionId"></name>
               <variable value="id"></variable>
               <variable value="ext"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="substanceAdministration"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="externalDocument"></name>
               <source>
                  <context value="reference"></context>
                  <element value="externalDocument"></element>
                  <variable value="externalDocument"></variable>
               </source>
               <rule>
                  <name value="innerExtensionExternalDocumentId"></name>
                  <source>
                     <context value="externalDocument"></context>
                     <element value="id"></element>
                     <variable value="id"></variable>
                  </source>
                  <target>
                     <context value="ext"></context>
                     <contextType value="variable"></contextType>
                     <element value="extension"></element>
                     <variable value="ext"></variable>
                  </target>
                  <dependent>
                     <name value="InnerExtensionExternalDocumentId"></name>
                     <variable value="id"></variable>
                     <variable value="ext"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="Element"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="idRef"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="observation"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%observation.text.reference.value.substring(1))).indexOf('&gt;') - 1)"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="observation"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="observation"></variable>
         </source>
         <rule>
            <name value="text"></name>
            <source>
               <context value="observation"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="text"></context>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </source>
               <rule>
                  <name value="narrativeLink"></name>
                  <source>
                     <context value="reference"></context>
                     <element value="value"></element>
                     <variable value="value"></variable>
                  </source>
                  <target>
                     <context value="dosage"></context>
                     <contextType value="variable"></contextType>
                     <element value="extension"></element>
                     <variable value="ext"></variable>
                  </target>
                  <dependent>
                     <name value="NarrativeLink"></name>
                     <variable value="value"></variable>
                     <variable value="ext"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="InnerExtensionExternalDocumentId"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="externalDocumentId"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="id"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Identifier"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="II"></name>
            <variable value="src"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="InnerExtensionId"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="id"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Identifier"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="II"></name>
            <variable value="src"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
   </group>
</StructureMap>